#!/usr/bin/env node

var voyager = require('../voyager')
  , cmd = require('commander')
  , fs = require('graceful-fs')
  , join = require('path').join
  , reqd = require('require-dir')

  , CWD = process.cwd()
  , PKG = JSON.parse(fs.readFileSync(join(__dirname, '../package.json'), { encoding: 'utf-8' }));

// Try to load deprecated default tasks
try { 
  console.warning('Default tasks in voyager have been deprecated. Consider upgrading!');
  reqd('../tasks'); 
} catch (err) { console.error(err); }

// Try to load user tasks
try { reqd(join(CWD, 'tasks')); } catch (err) { console.error(err); }

cmd.version(PKG.version);

cmd.command('build')
  .description('Build a production ready version of you site')
  .action(voyager.run.bind(voyager, 'build'));

cmd.command('clean')
  .description('Destroy .dev and build directories')
  .action(voyager.run.bind(voyager, 'clean'));

//cmd.command('init')
  //.description('Create a new voyager project in an empty directory')
  //.action(init);

cmd.command('start')
  .alias('s')
  .description('Start the local static server and watch files for changes')
  .action(voyager.run.bind(voyager, 'start'));

cmd.command('task <taskname>')
  .alias('t')
  .description('Run a specific task, including custom defined tasks')
  .action(function (taskname) {
    voyager.run(taskname);
  });

cmd.parse(process.argv);
